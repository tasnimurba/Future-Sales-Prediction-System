<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/css/dash.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">


</head>
<body>

<h2 class="welcome-text" th:if="${user != null}">Welcome, <span th:text="${user.name}">User</span></h2>

<!-- Update Product Form -->
<form th:if="${editingProduct != null}" th:action="@{/dashboard/update-product}" th:object="${editingProduct}" method="post">
    <input type="hidden" th:field="*{PId}" />
    <input type="text" th:field="*{name}" placeholder="Product Name" required />
    <input type="text" th:field="*{category}" placeholder="Category" required />
    <input type="number" step="0.01" th:field="*{price}" placeholder="Price" required />
    <input type="text" th:field="*{location}" placeholder="Location" required />



    <!-- âœ… Replace with this instead -->
    <input type="text" th:field="*{latitude}" placeholder="Latitude" readonly />
    <input type="text" th:field="*{longitude}" placeholder="Longitude" readonly />




    <button type="submit">Update Product</button>
    <a href="/dashboard" style="margin-left:10px;">Cancel</a>
</form>

<!-- Add Product Form -->
<form th:action="@{/dashboard/add-product}" th:object="${product}" method="post">
    <input type="text" th:field="*{PId}" placeholder="Product Id" required />
    <input type="text" th:field="*{name}" placeholder="Product Name" required />
    <input type="text" th:field="*{category}" placeholder="Category" required />
    <input type="number" step="0.01" th:field="*{price}" placeholder="Price" required />
    <input type="text" th:field="*{location}" placeholder="Location" required />


    <!-- âœ… Replace with this instead -->
    <input type="text" th:field="*{latitude}" placeholder="Latitude" readonly />
    <input type="text" th:field="*{longitude}" placeholder="Longitude" readonly />


    <!--<button type="submit">Add Product </button> -->
    <button type="submit">
        <i class="fa-solid fa-plus"></i> Add Product
    </button>

</form>

<!-- Product List -->
<table th:if="${user != null}">
    <thead>
    <tr>
        <th>Product Id</th>
        <th>Product Name</th>
        <th>Category</th>
        <th>Price</th>
        <th>Location</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <!-- <tr th:each="product : ${user.products}">-->
     <tr th:each="product : ${productList}">
     <td th:text="${product.pId}"></td>
         <td th:text="${product.name}"></td>
         <td th:text="${product.category}"></td>
         <td th:text="${product.price}"></td>
         <td th:text="${product.location}"></td>
         <td>
             <!-- Edit button -->
            <form th:action="@{/dashboard/get-product}" method="post" style="display:inline;">
                <input type="hidden" name="productId" th:value="${product.pId}" />
                <!-- <button type="submit">Edit</button> -->
                <button type="submit">
                    <i class="fa-solid fa-pencil" style="margin-right: 5px;"></i> Edit
                </button>

            </form>

            <!-- Delete button (âœ… fixed here) -->
            <form th:action="@{/dashboard/delete-product}" method="post" style="display:inline;">
                <input type="hidden" name="productId" th:value="${product.pId}" />
                <!--<button type="submit" onclick="return confirm('Are you sure to delete this product?');">Delete</button> -->
                <button type="submit" onclick="return confirm('Are you sure to delete this product?');">
                    <i class="fa-solid fa-trash" style="margin-right: 5px;"></i> Delete
                </button>

            </form>
        </td>
    </tr>
    </tbody>
</table>

<!-- Sales Prediction Form -->
<form th:action="@{/predict-sales}" method="post" th:object="${predictionDto}">
    <input type="text" th:field="*{productName}" placeholder="Enter product name" required />
    <div th:each="entry, iterStat : *{entries}">
        <input type="date" th:field="*{entries[__${iterStat.index}__].date}" />
        <input type="number" th:field="*{entries[__${iterStat.index}__].unitsSold}" placeholder="Units sold" />
    </div>
    <button type="submit">Predict</button>
</form>

<!-- Prediction Result -->
<div th:if="${prediction}">
    <h3>Prediction Result</h3>
    <div th:utext="${prediction}"></div>
</div>

<!-- Error -->
<div th:if="${error}">
    <p style="color:red;" th:text="${error}"></p>
</div>


<div class="sidebar-buttons">
    <a href="/dashboard/trends" class="sidebar-btn">
        <i class="fas fa-chart-line"></i> View Predictions
    </a>

    <a href="/image-upload" class="sidebar-btn">
        <i class="fas fa-image"></i> Upload Product Image
    </a>

    <form th:action="@{/logout}" method="post">
        <button type="submit" class="sidebar-btn logout-btn">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </form>

    <a href="/map"><button>ðŸ—º View Product Map</button></a>


</div>


</body>
</html>
